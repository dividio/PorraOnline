<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html" 
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:a4j="http://richfaces.org/a4j"
                xmlns:rich="http://richfaces.org/rich" 
				template="/WEB-INF/templates/template.xhtml">

<f:metadata>
    <f:viewParam name="idPartida" value="#{administrarPartidaBean.idPartida}" required="true" />
</f:metadata>

<ui:define name="side_menu">
    <ui:include src="/jsf/partidas/MenuPartida.xhtml"/>
</ui:define>

<ui:define name="body">
    <a4j:outputPanel id="panel">
    <h1>Administrar Partida</h1>
    <h2>#{administrarPartidaBean.partida}</h2>
    <a4j:outputPanel rendered="#{administrarPartidaBean.partida.pa_id == null}">
        <p>No tienes permisos para administrar esta partida.</p>
    </a4j:outputPanel>
	<h:form rendered="#{administrarPartidaBean.partida.pa_id != null}">

        <a4j:commandLink value="Guardar" action="#{administrarPartidaBean.guardarPartida}" render="panel"/>
        <fieldset class="formulario">
            <h:outputLabel for="nombre">Nombre:</h:outputLabel>
            <h:inputText id="nombre" value="#{administrarPartidaBean.partida.pa_nombre}"/>
            
            <h:outputLabel for="alias">Alias Competidores:</h:outputLabel>
            <h:inputText id="alias" value="#{administrarPartidaBean.partida.pa_alias_competidores}"/>
            
            <h:outputLabel for="fecha_inicio">Fecha Inicio:</h:outputLabel>
            <rich:calendar id="fecha_inicio" value="#{administrarPartidaBean.partida.pa_fecha_inicio}" datePattern="dd/MM/yyyy" timeZone="#{loginBean.timeZone}"/>
            
            <h:outputLabel for="fecha_fin">Fecha Fin:</h:outputLabel>
            <rich:calendar id="fecha_fin" value="#{administrarPartidaBean.partida.pa_fecha_fin}" datePattern="dd/MM/yyyy" timeZone="#{loginBean.timeZone}"/>
            
            <h:outputLabel for="descripcion">Descripción:</h:outputLabel>
            <h:inputTextarea id="descripcion" value="#{administrarPartidaBean.partida.pa_descripcion}" rows="5" cols="40"/>
        </fieldset>
        
        <a4j:commandLink value="Nuevo Competidor" 
            action="#{administrarPartidaBean.nuevoCompetidor}" 
            render="panelCompetidor"
            oncomplete="#{rich:component('panelCompetidor')}.show();"/>
        <rich:dataTable styleClass="table table-striped table-bordered" id="listaCompetidores" value="#{administrarPartidaBean.listaCompetidores}" var="competidor" rows="10">
            <f:facet name="header">Competidores</f:facet>
            <rich:column>
                <f:facet name="header">Nombre</f:facet>
                #{competidor.co_nombre}
            </rich:column>
            <rich:column>
                <a4j:commandLink value="Editar" oncomplete="#{rich:component('panelCompetidor')}.show();" render="panelCompetidor">
                    <f:setPropertyActionListener target="#{administrarPartidaBean.competidor}" value="#{competidor}"/>
                </a4j:commandLink>
                | Eliminar
            </rich:column>
            <f:facet name="footer">
                <rich:dataScroller renderIfSinglePage="false" fastControls="hide"/>
            </f:facet>
        </rich:dataTable>
        
        <a4j:commandLink value="Nuevo Evento" 
            action="#{administrarPartidaBean.nuevoEvento}" 
            render="panelEvento"
            oncomplete="#{rich:component('panelEvento')}.show();"/>
        <rich:dataTable styleClass="table table-striped table-bordered" id="listaEventos" value="#{administrarPartidaBean.listaEventos}" var="evento" rows="10">
            <f:facet name="header">Eventos</f:facet>
            <rich:column>
                <f:facet name="header">Nombre</f:facet>
                #{evento.ev_nombre}
            </rich:column>
            <rich:column>
                <f:facet name="header">Fecha Evento</f:facet>
                <h:outputText value="#{evento.ev_fecha_evento}">
                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="#{loginBean.timeZone}"/>
                </h:outputText>
            </rich:column>
            <rich:column>
                <f:facet name="header">Fecha Limite</f:facet>
                <h:outputText value="#{evento.ev_fecha_limite_pronosticos}">
                    <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="#{loginBean.timeZone}"/>
                </h:outputText>
            </rich:column>
            <rich:column>
                <a4j:commandLink value="Editar" oncomplete="#{rich:component('panelEvento')}.show();" render="panelEvento">
                    <f:setPropertyActionListener target="#{administrarPartidaBean.evento}" value="#{evento}"/>
                </a4j:commandLink>
                | Eliminar
            </rich:column>
            <f:facet name="footer">
                <rich:dataScroller renderIfSinglePage="false" fastControls="hide"/>
            </f:facet>
        </rich:dataTable>
        
        <div class="menu_horizontal">
        <a4j:commandLink value="Nueva Posición" 
            action="#{administrarPartidaBean.nuevaPosicion}" 
            render="panelPuntosPosicion"
            oncomplete="#{rich:component('panelPuntosPosicion')}.show();"/>
        <a4j:commandLink value="Eliminar Ultima Posición" 
            action="#{administrarPartidaBean.eliminarUltimaPosicion}"
            render="listaPuntosPosicion"/>
        </div>
        <rich:dataTable styleClass="table table-striped table-bordered" id="listaPuntosPosicion" value="#{administrarPartidaBean.listaPuntosPosicion}" var="posicion" rows="10">
            <f:facet name="header">Puntos por Posición</f:facet>
            <rich:column>
                <f:facet name="header">Posición</f:facet>
                #{posicion.pp_posicion}
            </rich:column>
            <rich:column>
                <f:facet name="header">Puntos para el que acierte</f:facet>
                #{posicion.pp_puntos}
            </rich:column>
            <rich:column>
                <f:facet name="header">Nivel aproximación</f:facet>
                #{posicion.pp_nivel_aproximacion}
            </rich:column>
            <rich:column>
                <f:facet name="header">Puntos para el que se aproxime</f:facet>
                #{posicion.pp_puntos_aproximacion}
            </rich:column>
            <rich:column>
                <a4j:commandLink styleClass="btn" title="Editar" oncomplete="#{rich:component('panelPuntosPosicion')}.show();" render="panelPuntosPosicion">
                    <f:setPropertyActionListener target="#{administrarPartidaBean.puntosPosicion}" value="#{posicion}"/>
                    <i class="icon-edit"></i>
                </a4j:commandLink>
            </rich:column>
            <f:facet name="footer">
                <rich:dataScroller renderIfSinglePage="false" fastControls="hide"/>
            </f:facet>
        </rich:dataTable>
    </h:form>
    </a4j:outputPanel>
    
    <rich:popupPanel id="panelCompetidor" onmaskclick="#{rich:component('panelCompetidor')}.hide();" autosized="true">
        <f:facet name="header">Competidor</f:facet>
        <h:form>
            <a4j:commandLink value="Guardar" 
                action="#{administrarPartidaBean.guardarCompetidor}"
                oncomplete="#{rich:component('panelCompetidor')}.hide();"
                render="listaCompetidores"/>
            <fieldset class="formulario">
                <h:outputLabel for="nombreCompetidor" value="Nombre:"/>
	            <h:inputText id="nombreCompetidor" value="#{administrarPartidaBean.competidor.co_nombre}"/>
            </fieldset>
        </h:form>
    </rich:popupPanel>
    
    <rich:popupPanel id="panelEvento" onmaskclick="#{rich:component('panelEvento')}.hide();" autosized="true">
        <f:facet name="header">Evento</f:facet>
        <h:form>
            <a4j:commandLink value="Guardar" 
                action="#{administrarPartidaBean.guardarEvento}"
                oncomplete="#{rich:component('panelEvento')}.hide();"
                render="listaEventos"/>
            <fieldset class="formulario">
                <h:outputLabel for="nombreEvento" value="Nombre:"/>
                <h:inputText id="nombreEvento" required="true" value="#{administrarPartidaBean.evento.ev_nombre}" label="Nombre Evento"/>
                
                <h:outputLabel for="lugarEvento" value="Lugar:"/>
                <h:inputText id="lugarEvento" value="#{administrarPartidaBean.evento.ev_lugar}" label="Lugar Evento"/>
                
                <h:outputLabel for="urlEvento" value="URL:"/>
                <h:inputText id="urlEvento" value="#{administrarPartidaBean.evento.ev_url_referencia}" label="Url Evento"/>
                
                <h:outputLabel for="fechaEvento" value="Fecha Evento:"/>
                <rich:calendar id="fechaEvento" required="true" datePattern="dd/MM/yyyy HH:mm" value="#{administrarPartidaBean.evento.ev_fecha_evento}" timeZone="#{loginBean.timeZone}"/>
                
                <h:outputLabel for="fechaInicioEvento" value="Fecha Inicio Pronósticos:"/>
                <rich:calendar id="fechaInicioEvento" required="true" datePattern="dd/MM/yyyy HH:mm" value="#{administrarPartidaBean.evento.ev_fecha_inicio_pronosticos}" timeZone="#{loginBean.timeZone}"/>
                
                <h:outputLabel for="fechaLimiteEvento" value="Fecha Limite Pronósticos:"/>
                <rich:calendar id="fechaLimiteEvento" required="true" datePattern="dd/MM/yyyy HH:mm" value="#{administrarPartidaBean.evento.ev_fecha_limite_pronosticos}" timeZone="#{loginBean.timeZone}"/>
                
                <h:outputLabel for="numeroPronosticos" value="Número Pronósticos:"/>
                <h:inputText id="numeroPronosticos" label="Número Pronosticos" required="true" value="#{administrarPartidaBean.evento.ev_numero_pronosticos}"/>
            </fieldset>
        </h:form>
    </rich:popupPanel>
    
    <rich:popupPanel id="panelPuntosPosicion" onmaskclick="#{rich:component('panelPuntosPosicion')}.hide();" autosized="true">
        <f:facet name="header">Puntos por posición</f:facet>
        <h:form>
            <a4j:commandLink value="Guardar" 
                action="#{administrarPartidaBean.guardarPuntosPosicion}"
                oncomplete="#{rich:component('panelPuntosPosicion')}.hide();"
                render="listaPuntosPosicion"/>
            <fieldset class="formulario">
                <h:outputLabel for="posicion" value="Posición:"/>
                <h:outputText id="posicion" value="#{administrarPartidaBean.puntosPosicion.pp_posicion}"/>
                                
                <h:outputLabel for="puntos" value="Puntos para el que acierte:"/>
                <h:inputText id="puntos" value="#{administrarPartidaBean.puntosPosicion.pp_puntos}"/>
                
                <h:outputLabel id="labelNivelAproximacion" for="nivelAproximacion">Nivel Aproximación:</h:outputLabel>
                <rich:tooltip target="labelNivelAproximacion">Nivel Aproximación: diferencia de posiciones por las que los usuarios se llevan puntos de aproximación</rich:tooltip>
                <h:inputText id="nivelAproximacion" value="#{administrarPartidaBean.puntosPosicion.pp_nivel_aproximacion}"/>
                
                <h:outputLabel for="puntosAproximacion" value="Puntos para el que se aproxime:"/>
                <h:inputText id="puntosAproximacion" value="#{administrarPartidaBean.puntosPosicion.pp_puntos_aproximacion}"/>
            </fieldset>
        </h:form>
    </rich:popupPanel>
</ui:define>

</ui:composition>