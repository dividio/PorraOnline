<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html" 
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:a4j="http://richfaces.org/a4j"
                xmlns:rich="http://richfaces.org/rich" 
				template="/WEB-INF/templates/template.xhtml">

<f:metadata>
    <f:viewParam name="idPartida" value="#{clasificacionEventosBean.idPartida}"/>
</f:metadata>

<ui:define name="side_menu">
    <ui:include src="/jsf/partidas/MenuPartida.xhtml"/>
</ui:define>

<ui:define name="body">
    <h1>Clasificación por Eventos</h1>
    <h2>#{clasificacionEventosBean.partida}</h2>
    <a4j:outputPanel rendered="#{clasificacionEventosBean.partida.pa_id == null}">
        <p>No estas suscrito a esta partida.</p>
    </a4j:outputPanel>
    <h:form rendered="#{clasificacionEventosBean.partida.pa_id != null}">
        <a4j:outputPanel rendered="#{clasificacionEventosBean.evento == null}">
            <p>No hay ningún próximo evento previsto.</p>
        </a4j:outputPanel>
        <a4j:outputPanel id="panelEvento" rendered="#{clasificacionEventosBean.evento != null}">
        
            <a4j:commandLink value="Buscar Eventos" 
                    action="#{clasificacionEventosBean.cargarListaEventos}"
                    render="panelBuscadorEventos"
                    oncomplete="#{rich:component('panelBuscadorEventos')}.show();"/>
            <article>
                <h3>#{clasificacionEventosBean.evento.ev_nombre}</h3>
            </article>
            
            <rich:dataTable styleClass="table table-striped table-bordered" id="clasificacion" value="#{clasificacionEventosBean.clasificacion}" var="puesto">
	            <f:facet name="header">Clasificación</f:facet>
	            <rich:column>
	                <f:facet name="header">Posición</f:facet>
	                #{puesto[1]} 
	            </rich:column>
	            <rich:column>
	                <f:facet name="header">Usuario</f:facet>
	                <h:link value="#{puesto[2]}" outcome="pronosticosUsuario">
	                    <f:param name="idPartida" value="#{clasificacionEventosBean.idPartida}"/>
	                    <f:param name="idUsuario" value="#{puesto[0]}"/>
	                </h:link>
	            </rich:column>
	            <rich:column>
	                <f:facet name="header">Puntos</f:facet>
	                #{puesto[3]} 
	            </rich:column>
	        </rich:dataTable>
	    </a4j:outputPanel>
    </h:form>
    
    <rich:popupPanel id="panelBuscadorEventos" onmaskclick="#{rich:component('panelBuscadorEventos')}.hide();" autosized="true" onshow="adaptarPopupPanel(panelBuscadorEventos);">
        <h:form>
            <rich:dataTable styleClass="table table-striped table-bordered" value="#{clasificacionEventosBean.listaEventos}" var="evento" rows="10">
                <f:facet name="header">Lista de Eventos</f:facet>
                <rich:column>
                    <f:facet name="header">Evento</f:facet>
                    <a4j:commandLink action="#{clasificacionEventosBean.cargarNuevoEvento}"
                            render="panelEvento"
                            oncomplete="#{rich:component('panelBuscadorEventos')}.hide();">
                        <h:outputText value="#{evento.ev_nombre}"/>
                        <f:setPropertyActionListener target="#{clasificacionEventosBean.evento}" value="#{evento}"/>
                    </a4j:commandLink> 
                </rich:column>
                <rich:column>
	                <f:facet name="header">Fecha Evento</f:facet>
	                <a4j:commandLink action="#{clasificacionEventosBean.cargarNuevoEvento}"
                            render="panelEvento"
                            oncomplete="#{rich:component('panelBuscadorEventos')}.hide();">
                        <h:outputText value="#{evento.ev_fecha_evento}">
	                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="#{loginBean.timeZone}"/>
	                    </h:outputText>
                        <f:setPropertyActionListener target="#{clasificacionEventosBean.evento}" value="#{evento}"/>
                    </a4j:commandLink>
	            </rich:column>
	            <rich:column>
                    <f:facet name="header">Fecha Inicio Pronósticos</f:facet>
                    <a4j:commandLink action="#{clasificacionEventosBean.cargarNuevoEvento}"
                            render="panelEvento"
                            oncomplete="#{rich:component('panelBuscadorEventos')}.hide();">
                        <h:outputText value="#{evento.ev_fecha_inicio_pronosticos}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="#{loginBean.timeZone}"/>
                        </h:outputText>
                        <f:setPropertyActionListener target="#{clasificacionEventosBean.evento}" value="#{evento}"/>
                    </a4j:commandLink>
                </rich:column>
	            <rich:column>
	                <f:facet name="header">Fecha Límite Pronósticos</f:facet>
	                <a4j:commandLink action="#{clasificacionEventosBean.cargarNuevoEvento}"
                            render="panelEvento"
                            oncomplete="#{rich:component('panelBuscadorEventos')}.hide();">
                        <h:outputText value="#{evento.ev_fecha_limite_pronosticos}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="#{loginBean.timeZone}"/>
                        </h:outputText>
                        <f:setPropertyActionListener target="#{clasificacionEventosBean.evento}" value="#{evento}"/>
                    </a4j:commandLink>
	            </rich:column>
                <f:facet name="footer">
                    <rich:dataScroller renderIfSinglePage="false" fastControls="hide">
	                    <f:param name="idPartida" value="#{clasificacionEventosBean.idPartida}"/>
	                </rich:dataScroller>
                </f:facet>
            </rich:dataTable>
        </h:form>
    </rich:popupPanel>
</ui:define>

</ui:composition>