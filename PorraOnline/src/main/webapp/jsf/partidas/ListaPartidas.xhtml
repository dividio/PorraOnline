<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html" 
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:a4j="http://richfaces.org/a4j"
                xmlns:rich="http://richfaces.org/rich" 
				template="/WEB-INF/templates/template.xhtml">

<ui:define name="body">
    <h1>Lista de Partidas</h1>
	<h:form>
        <a4j:commandLink value="Nueva Suscripción" 
            action="#{listaPartidasBean.mostrarPanelNuevaSuscripcion}" 
            render="panelNuevaSuscripcion"
            oncomplete="#{rich:component('panelNuevaSuscripcion')}.show();"/>
		<rich:dataTable id="listaPartidas" value="#{listaPartidasBean.listaPartidas}" var="partida">
            <f:facet name="header">Partidas en las que participas</f:facet>
            <rich:column width="40%">
                <f:facet name="header">Nombre</f:facet>
                <h:link value="#{partida.pa_nombre}" outcome="mensajesPartida">
                    <f:param name="idPartida" value="#{partida.pa_id}"/>
                </h:link> 
            </rich:column>
            <rich:column width="60%">
                    <f:facet name="header">Descripción</f:facet>
                    <h:link value="#{partida.pa_descripcion}" outcome="mensajesPartida">
	                    <f:param name="idPartida" value="#{partida.pa_id}"/>
	                </h:link>
            </rich:column>
            <f:facet name="footer">
                <rich:dataScroller renderIfSinglePage="false" fastControls="hide"/>
            </f:facet>
		</rich:dataTable>
    </h:form>
    
    <rich:popupPanel id="panelNuevaSuscripcion" onmaskclick="#{rich:component('panelNuevaSuscripcion')}.hide();" autosized="true">
        <f:facet name="header">Partidas a las que te puedes suscribir</f:facet>
        <h:form>
            <rich:dataTable value="#{listaPartidasBean.listaPartidasDisponibles}" var="partida">
	            <rich:column>
	                <f:facet name="header">Nombre</f:facet>
	                <h:outputText value="#{partida.pa_nombre}"/>
	            </rich:column>
	            <rich:column>
                    <f:facet name="header">Descripción</f:facet>
                    <h:outputText value="#{partida.pa_descripcion}"/>
                </rich:column>
                <rich:column>
                    <f:facet name="header">Fecha Fin</f:facet>
                    <h:outputText value="#{partida.pa_fecha_fin}"/>
                </rich:column>
                <rich:column>
                    <a4j:commandLink value="Suscribir" action="#{listaPartidasBean.suscribirPartida}"
                            render="listaPartidas"
                            oncomplete="#{rich:component('panelNuevaSuscripcion')}.hide();">
                        <f:setPropertyActionListener target="#{listaPartidasBean.partida}" value="#{partida}"/>
                    </a4j:commandLink> 
                </rich:column>
	            <f:facet name="footer">
	                <rich:dataScroller renderIfSinglePage="false" fastControls="hide"/>
	            </f:facet>
	        </rich:dataTable>
        </h:form>
    </rich:popupPanel>
</ui:define>

</ui:composition>