<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html" 
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:a4j="http://richfaces.org/a4j"
                xmlns:rich="http://richfaces.org/rich" 
				template="/WEB-INF/templates/template.xhtml">

<f:metadata>
    <f:viewParam name="idUsuario" value="#{pronosticosUsuarioBean.idUsuario}"/>
    <f:viewParam name="idPartida" value="#{pronosticosUsuarioBean.idPartida}"/>
</f:metadata>

<ui:define name="side_menu">
    <ui:include src="/jsf/partidas/MenuPartida.xhtml"/>
</ui:define>

<ui:define name="body">
    <h1>Pronósticos Usuario</h1>
    <h2>#{pronosticosUsuarioBean.partida}</h2>
    <a4j:outputPanel rendered="#{pronosticosUsuarioBean.partida.pa_id == null}">
        <p>No estas suscrito a esta partida.</p>
    </a4j:outputPanel>
    <h:form rendered="#{pronosticosUsuarioBean.partida.pa_id != null}">
        <a4j:outputPanel rendered="#{pronosticosUsuarioBean.evento == null}">
            <p>No hay ningún próximo evento previsto.</p>
        </a4j:outputPanel>
        <a4j:outputPanel id="panelEvento" rendered="#{pronosticosUsuarioBean.evento != null}">
        
            <a4j:commandLink value="Buscar Eventos" 
                    action="#{pronosticosUsuarioBean.cargarListaEventos}"
                    render="panelBuscadorEventos"
                    oncomplete="#{rich:component('panelBuscadorEventos')}.show();"/>
            <article>
                <h3>#{pronosticosUsuarioBean.usuario} - #{pronosticosUsuarioBean.evento.ev_nombre}</h3>
            </article>
	        
	        <rich:dataTable styleClass="table table-striped table-bordered" rendered="#{pronosticosUsuarioBean.eventoPasado}" id="listaPronosticos" value="#{pronosticosUsuarioBean.listaPronosticos}" var="pronostico" >
                <f:facet name="header">Pronóstico para el evento de #{pronosticosUsuarioBean.usuario}</f:facet>
                <rich:column>
                    <f:facet name="header">Posición</f:facet>
                    #{pronostico.pr_posicion}
                </rich:column>
                <rich:column>
                    <f:facet name="header">#{pronosticosUsuarioBean.partida.pa_alias_competidores}</f:facet>
                    #{pronostico.pr_co_id}
                </rich:column>
                <rich:column>
                    <f:facet name="header">Puntos</f:facet>
                    #{pronostico.pr_puntos_conseguidos}
                </rich:column>
	        </rich:dataTable>
	        
	        <rich:dataTable styleClass="table table-striped table-bordered" rendered="#{pronosticosUsuarioBean.hayResultados}" id="listaResultados" value="#{pronosticosUsuarioBean.listaResultados}" var="resultado" >
                <f:facet name="header">Resultados</f:facet>
                <rich:column>
                    <f:facet name="header">Posición</f:facet>
                    #{resultado.re_posicion}
                </rich:column>
                <rich:column>
                    <f:facet name="header">#{pronosticosUsuarioBean.partida.pa_alias_competidores}</f:facet>
                    #{resultado.re_co_id}
                </rich:column>
            </rich:dataTable>
	    </a4j:outputPanel>
    </h:form>
    
    <rich:popupPanel id="panelBuscadorEventos" onmaskclick="#{rich:component('panelBuscadorEventos')}.hide();" autosized="true" onshow="adaptarPopupPanel(panelBuscadorEventos);">
        <h:form>
            <rich:dataTable styleClass="table table-striped table-bordered" value="#{pronosticosUsuarioBean.listaEventos}" var="evento" rows="10">
                <f:facet name="header">Lista de Eventos</f:facet>
                <rich:column>
                    <f:facet name="header">Evento</f:facet>
                    <a4j:commandLink action="#{pronosticosUsuarioBean.cargarNuevoEvento}"
                            render="panelEvento"
                            oncomplete="#{rich:component('panelBuscadorEventos')}.hide();">
                        <h:outputText value="#{evento.ev_nombre}"/>
                        <f:setPropertyActionListener target="#{pronosticosUsuarioBean.evento}" value="#{evento}"/>
                    </a4j:commandLink> 
                </rich:column>
                <rich:column>
	                <f:facet name="header">Fecha Evento</f:facet>
	                <a4j:commandLink action="#{pronosticosUsuarioBean.cargarNuevoEvento}"
                            render="panelEvento"
                            oncomplete="#{rich:component('panelBuscadorEventos')}.hide();">
                        <h:outputText value="#{evento.ev_fecha_evento}">
	                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="#{loginBean.timeZone}"/>
	                    </h:outputText>
                        <f:setPropertyActionListener target="#{pronosticosUsuarioBean.evento}" value="#{evento}"/>
                    </a4j:commandLink>
	            </rich:column>
	            <rich:column>
                    <f:facet name="header">Fecha Inicio Pronósticos</f:facet>
                    <a4j:commandLink action="#{pronosticosUsuarioBean.cargarNuevoEvento}"
                            render="panelEvento"
                            oncomplete="#{rich:component('panelBuscadorEventos')}.hide();">
                        <h:outputText value="#{evento.ev_fecha_inicio_pronosticos}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="#{loginBean.timeZone}"/>
                        </h:outputText>
                        <f:setPropertyActionListener target="#{pronosticosUsuarioBean.evento}" value="#{evento}"/>
                    </a4j:commandLink>
                </rich:column>
	            <rich:column>
	                <f:facet name="header">Fecha Límite Pronósticos</f:facet>
	                <a4j:commandLink action="#{pronosticosUsuarioBean.cargarNuevoEvento}"
                            render="panelEvento"
                            oncomplete="#{rich:component('panelBuscadorEventos')}.hide();">
                        <h:outputText value="#{evento.ev_fecha_limite_pronosticos}">
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm" timeZone="#{loginBean.timeZone}"/>
                        </h:outputText>
                        <f:setPropertyActionListener target="#{pronosticosUsuarioBean.evento}" value="#{evento}"/>
                    </a4j:commandLink>
	            </rich:column>
                <f:facet name="footer">
                    <rich:dataScroller renderIfSinglePage="false" fastControls="hide">
	                    <f:param name="idPartida" value="#{pronosticosUsuarioBean.idPartida}"/>
	                </rich:dataScroller>
                </f:facet>
            </rich:dataTable>
        </h:form>
    </rich:popupPanel>
</ui:define>

</ui:composition>